{% extends "core/base.html" %} 
{% load static %} 
{% block head %}
<title>{{ dua.title }} - Dua Collection</title>
<link rel="stylesheet" href="{% static 'dua_collection/css/dua_detail.css' %}" />

<!-- Meta tags for sharing -->
<meta name="description" content="{{ dua.text|truncatewords:30 }}" />
<meta property="og:title" content="{{ dua.title }} - Dua Collection" />
<meta property="og:description" content="{{ dua.text|truncatewords:30 }}" />
<meta property="og:type" content="article" />
<meta property="og:url" content="{{ request.build_absolute_uri }}" />
{% endblock %} 
{% block content %}
<div class="container-fluid py-4">
  <!-- Header with back button -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex align-items-center mb-3">
        <a
          href="{% url 'dua_collection:dua_list' %}"
          class="btn btn-outline-primary me-3"
        >
          <i class="fas fa-arrow-left me-2"></i>
          Back to Collection
        </a>
        <h1 class="text-primary mb-0">
          <i class="fas fa-prayer-hands me-2"></i>
          Dua Details
        </h1>
      </div>
    </div>
  </div>

  <!-- Dua Detail Card -->
  <div class="row">
    <div class="col-12">
      <div class="card shadow-sm border-0 dua-card">
        <div class="card-body p-4">
          <!-- Title -->
          <h2 class="dua-title">{{ dua.title }}</h2>

          <!-- Main Dua Text -->
          <div class="dua-text mb-4" lang="ar" dir="rtl">{{ dua.text|linebreaks }}</div>

          <!-- Translations -->
          {% if translations %}
          <div class="mb-4">
            <h6 class="text-muted mb-3">
              <i class="fas fa-language me-1"></i>
              Translations:
            </h6>
            <div class="translations-container">
              {% for translation in translations %}
              <div class="card border-0 bg-light mb-3">
                <div class="card-body p-3">
                  <h6 class="card-subtitle mb-2 text-muted">
                    <i class="fas fa-globe me-1"></i>
                    {{ translation.get_language_display }}
                  </h6>
                  <div class="card-text" lang="{{ translation.language }}" {% if translation.language == 'ur' %}dir="rtl"{% endif %}>{{ translation.text|linebreaks }}</div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}

          <!-- Tags -->
          {% if dua.tags.all %}
          <div class="mb-4">
            <h6 class="text-muted mb-2">
              <i class="fas fa-tags me-1"></i>
              Tags:
            </h6>
            <div class="d-flex flex-wrap">
              {% for tag in dua.tags.all %}
              <a
                href="{% url 'dua_collection:dua_list' %}?tags={{ tag.id }}"
                class="badge bg-primary me-2 mb-2 text-decoration-none tag-badge"
              >
                <i class="fas fa-tag me-1"></i>{{ tag.name }}
              </a>
              {% endfor %}
            </div>
          </div>
          {% endif %}

          <!-- Source -->
          {% if dua.source %}
          <div class="mb-4">
            <h6 class="text-muted mb-2">
              <i class="fas fa-link me-1"></i>
              Source:
            </h6>
            <a href="{{ dua.source }}" target="_blank" class="source-link">
              <i class="fas fa-external-link-alt me-1"></i>
              {{ dua.source|truncatechars:60 }}
            </a>
          </div>
          {% endif %}

          <!-- Share button -->
          <div class="mt-4 pt-3 border-top">
            <button
              class="btn btn-sm btn-outline-primary"
              id="copy-link-btn"
              onclick="copyToClipboard('{{ request.build_absolute_uri }}', this)"
            >
              <i class="fas fa-copy me-1"></i>
              Copy Link
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  async function copyToClipboard(text, button) {
    try {
      await navigator.clipboard.writeText(text);
      const originalContent = button.innerHTML;
      button.innerHTML = '<i class="fas fa-check me-1"></i>Copied!';
      button.className = "btn btn-sm btn-success";
      setTimeout(() => {
        button.innerHTML = originalContent;
        button.className = "btn btn-sm btn-outline-primary";
      }, 2000);
    } catch (err) {
      // Fallback for older browsers
      const textArea = document.createElement("textarea");
      textArea.value = text;
      document.body.appendChild(textArea);
      textArea.select();
      document.execCommand("copy");
      document.body.removeChild(textArea);

      button.innerHTML = '<i class="fas fa-check me-1"></i>Copied!';
      button.className = "btn btn-sm btn-success";
      setTimeout(() => {
        button.innerHTML = '<i class="fas fa-copy me-1"></i>Copy Link';
        button.className = "btn btn-sm btn-outline-primary";
      }, 2000);
    }
  }
</script>
{% endblock %}
